<UserControl x:Class="Postgirl.Presentation.Views.RequestDocumentView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:auth="clr-namespace:Postgirl.Domain.Authentication"
             xmlns:body="clr-namespace:Postgirl.Domain.Http.Body">

  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="2*"/>
      <RowDefinition Height="3*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Request line -->
    <Grid Grid.Row="0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <ComboBox Width="100"
                SelectedItem="{Binding Method}"
                ItemsSource="{Binding HttpMethods}"
                >
      </ComboBox>

      <TextBox Grid.Column="1"
               Margin="10,0"
               Text="{Binding Url}" />

      <Button Grid.Column="2"
              Width="100"
              Content="Send"
              Command="{Binding SendCommand}" />
    </Grid>

    <!-- Body -->
    <StackPanel Grid.Row="1" Margin="0,10,0,0">
	    <Label Content="Request"/>

	    <TabControl>
		    <!-- BODY -->
		    <TabItem Header="Body">
			    <Grid Margin="8">
				    <Grid.RowDefinitions>
					    <RowDefinition Height="Auto"/>
					    <RowDefinition Height="*"/>
				    </Grid.RowDefinitions>

				    <!-- Body type selector -->
				    <StackPanel Orientation="Horizontal"
				                Grid.Row="0"
				                Margin="0,0,0,8"
				                VerticalAlignment="Center">

					    <TextBlock Text="Body:"
					               VerticalAlignment="Center"
					               Margin="0,0,6,0"
					               FontWeight="SemiBold"/>

							<ComboBox ItemsSource="{Binding Source={x:Static body:BodyTypeHelper.GetValues}}"
					              SelectedItem="{Binding SelectedBodyType}"
					              Margin="0,0,0,8"/>
						</StackPanel>

				    <!-- Body editor -->
				    <TextBox Grid.Row="1"
				             Text="{Binding RequestBody}"
				             AcceptsReturn="True"
				             VerticalScrollBarVisibility="Auto"
				             HorizontalScrollBarVisibility="Auto"
				             Visibility="{Binding SelectedBodyType,
								Converter={StaticResource BodyTypeToVisibilityConverter}}"
				             FontFamily="Consolas"/>
			    </Grid>
				</TabItem>

			<!-- Auth -->
			<TabItem Header="Auth">

				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="220"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>

					<!-- LEFT -->
					<StackPanel Grid.Column="0"
					            Margin="8">

						<TextBlock Text="Authentication Type"
						           FontWeight="SemiBold"
						           Margin="0,0,0,6"/>

						<ComboBox ItemsSource="{Binding Auth.AvailableAuthTypes}"
						          SelectedItem="{Binding Auth.AuthType}" />
					</StackPanel>

					<!-- RIGHT -->
						<Border Grid.Column="1"
        Margin="8"
        BorderBrush="#DDD"
        BorderThickness="1"
        CornerRadius="4"
        Padding="12">

							<ContentControl>

								<ContentControl.Style>
									<Style TargetType="ContentControl">

										<!-- default: empty -->
										<Setter Property="Content" Value="{x:Null}" />

										<Style.Triggers>

											<!-- NO AUTH -->
											<DataTrigger Binding="{Binding Auth.AuthType}"
                                 Value="{x:Static auth:AuthType.None}">
												<Setter Property="Content">
													<Setter.Value>
														<TextBlock Text="This request does not use any authorization."
                                           Foreground="Gray"
                                           FontStyle="Italic"
                                           TextWrapping="Wrap"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
													</Setter.Value>
												</Setter>
											</DataTrigger>

											<!-- BEARER TOKEN -->
											<DataTrigger Binding="{Binding Auth.AuthType}"
                                 Value="{x:Static auth:AuthType.BearerToken}">
												<Setter Property="Content">
													<Setter.Value>

														<StackPanel>

															<TextBlock Text="Bearer Token"
                                               FontWeight="SemiBold"
                                               Margin="0,0,0,6"/>

															<TextBox Text="{Binding Auth.BearerToken, UpdateSourceTrigger=PropertyChanged}"
                                             MinWidth="300"/>

															<TextBlock Text="The token will be sent in the Authorization header."
                                               Margin="0,6,0,0"
                                               Foreground="Gray"
                                               FontSize="11"/>

														</StackPanel>
													</Setter.Value>
												</Setter>
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</ContentControl.Style>
							</ContentControl>
						</Border>
					</Grid>

			</TabItem>



<!-- HEADERS -->
			<TabItem Header="Headers">

				<DockPanel>

					<!-- ADD HEADER BUTTON -->
					<Button Content="+ Add Header"
                Command="{Binding AddHeaderCommand}"
                DockPanel.Dock="Top"
                HorizontalAlignment="Left"
                Margin="0,0,0,8"/>

						<!-- HEADERS GRID -->
						<DataGrid ItemsSource="{Binding RequestHeaders}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False">

							<DataGrid.Columns>

								<!-- ENABLE -->
								<DataGridTemplateColumn Width="40">
									<DataGridTemplateColumn.CellTemplate>
										<DataTemplate>
											<CheckBox IsChecked="{Binding IsEnabled}"
                                      IsEnabled="{Binding CanEdit}" />
										</DataTemplate>
									</DataGridTemplateColumn.CellTemplate>
								</DataGridTemplateColumn>

								<!-- KEY -->
								<DataGridTextColumn
                    Header="Header"
                    Binding="{Binding Key}"
                    Width="200"
                    ElementStyle="{StaticResource HeaderValueTextStyle}"
                    EditingElementStyle="{StaticResource HeaderValueEditStyle}" />

								<!-- VALUE -->
								<DataGridTextColumn
                    Header="Value"
                    Binding="{Binding Value}"
                    Width="*"
                    ElementStyle="{StaticResource HeaderValueTextStyle}"
                    EditingElementStyle="{StaticResource HeaderValueEditStyle}" />

								<!-- REMOVE -->
								<DataGridTemplateColumn Width="40">
									<DataGridTemplateColumn.CellTemplate>
										<DataTemplate>
											<Button Content="âœ–"
                                    Command="{Binding RemoveCommand}"
                                    IsEnabled="{Binding CanEdit}"
                                    ToolTip="Remove header"
                                    Padding="2"/>
										</DataTemplate>
									</DataGridTemplateColumn.CellTemplate>
								</DataGridTemplateColumn>

							</DataGrid.Columns>
						</DataGrid>

					</DockPanel>

				</TabItem>

			</TabControl>

    </StackPanel>

		<!-- Response -->
    <StackPanel Grid.Row="2" Margin="0,10,0,0">
      <Label Content="Response:"/>
      <TabControl>
        <TabItem Header="Body">
          <TextBox Text="{Binding ResponseBody}"
                   Background="Black"
                   Foreground="LightGreen"
                   FontFamily="Consolas"
                   AcceptsReturn="True"
                   IsReadOnly="True"/>
        </TabItem>
        <TabItem Header="Headers">
          <ListBox ItemsSource="{Binding ResponseHeaders}"
                   FontFamily="Consolas"/>
        </TabItem>
      </TabControl>
    </StackPanel>

    <!-- Status bar -->
    <Border Grid.Row="3"
            Background="#F0F0F0"
            BorderBrush="#D0D0D0"
            BorderThickness="0,1,0,0"
            Margin="0,8,0,0"
            Padding="8,4">
      <StackPanel Orientation="Horizontal"
                  VerticalAlignment="Center">
        <TextBlock Text="{Binding StatusCode}"
                   Foreground="{Binding StatusColor}"
                   FontWeight="SemiBold"
                   FontFamily="Consolas"
                   MinWidth="36"/>
        <TextBlock Text="{Binding StatusText}"
                   Margin="8,0,0,0"
                   Foreground="#666"
                   VerticalAlignment="Center"/>
        <TextBlock Text="{Binding ElapsedMilliseconds, StringFormat='{}{0} ms'}"
                   Margin="8,0,0,0"
                   Foreground="#666"
                   FontFamily="Consolas"
                   VerticalAlignment="Center"/>
      </StackPanel>
    </Border>
  </Grid>
</UserControl>
